<!DOCTYPE html>
<html>
<head>
    <title>增强版博客创作系统</title>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* 新增样式部分 */
        .toolbar { margin: 10px 0; display: flex; gap: 8px; flex-wrap: wrap; }
        .toolbar button { padding: 6px 12px; background: #6c757d; }
        .emojipicker { 
            position: absolute; 
            background: white; 
            border: 1px solid #ccc; 
            padding: 10px; 
            max-height: 200px; 
            overflow-y: auto;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .media-preview { max-width: 200px; margin: 5px; }
    </style>
</head>
<body>
    <!-- 在原配置基础上新增工具栏 -->
    <div class="toolbar">
        <button onclick="insertEmoji('😀')">😀 表情</button>
        <button onclick="showEmojiPanel()">😺 表情包</button>
        <button onclick="insertImage()"><i class="fas fa-image"></i> 图片</button>
        <button onclick="insertVideo()"><i class="fas fa-video"></i> 视频</button>
        <button onclick="insertTemplate()"><i class="fas fa-file-alt"></i> 模板</button>
    </div>

    <!-- 原有编辑区保持不变，新增以下隐藏元素 -->
    <input type="file" id="imageUpload" hidden accept="image/*">
    <div id="emojiPanel" class="emojipicker" style="display: none;"></div>

    <script>
        // 新增功能实现部分
        const EMOJIS = ['😀','😂','😍','🤔','👍','👏','🎉','❤️','🔥','💡'];
        const TEMPLATES = {
            codeBlock: "```javascript\n// 代码示例\nfunction example() {\n  console.log('Hello World');\n}\n```",
            quote: "> 经典引用内容"
        };

        // 显示表情面板
        function showEmojiPanel() {
            const panel = document.getElementById('emojiPanel');
            panel.innerHTML = EMOJIS.map(e => 
                `<button onclick="insertEmoji('${e}')" style="font-size: 24px; margin: 3px;">${e}</button>`
            ).join('');
            panel.style.display = 'block';
            setTimeout(() => window.addEventListener('click', closeEmojiPanel), 0);
        }

        function closeEmojiPanel() {
            document.getElementById('emojiPanel').style.display = 'none';
            window.removeEventListener('click', closeEmojiPanel);
        }

        // 插入表情
        function insertEmoji(emoji) {
            insertText(` ${emoji} `);
        }

        // 图片处理
        function insertImage() {
            document.getElementById('imageUpload').click();
        }

        document.getElementById('imageUpload').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            try {
                // 此处替换为你的图片上传API地址（需自行实现或使用第三方服务）
                const formData = new FormData();
                formData.append('image', file);
                
                // 示例使用imgur匿名上传（需遵守其API规则）
                const response = await fetch('https://api.imgur.com/3/image', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Client-ID YOUR_CLIENT_ID'
                    },
                    body: formData
                });
                
                const data = await response.json();
                if (data.success) {
                    insertText(`![图片描述](${data.data.link})`);
                }
            } catch (error) {
                alert('图片上传失败: ' + error.message);
            }
        });

        // 插入视频（支持主流平台）
        function insertVideo() {
            const url = prompt('请输入视频链接（YouTube/B站等）:');
            if (url) {
                if (url.includes('youtube') || url.includes('youtu.be')) {
                    const vid = url.match(/(?:v=|\/)([a-zA-Z0-9_-]{11})/)[1];
                    insertText(`\n<iframe width="560" height="315" src="https://www.youtube.com/embed/${vid}" frameborder="0" allowfullscreen></iframe>\n`);
                } else if (url.includes('bilibili')) {
                    const vid = url.match(/video\/(BV\w+)/)[1];
                    insertText(`\n<iframe src="//player.bilibili.com/player.html?bvid=${vid}" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>\n`);
                } else {
                    insertText(`\n[视频](${url})\n`);
                }
            }
        }

        // 插入写作模板
        function insertTemplate() {
            const choice = prompt('选择模板:\n1. 代码块\n2. 引用');
            switch(choice) {
                case '1': insertText(TEMPLATES.codeBlock); break;
                case '2': insertText(TEMPLATES.quote); break;
            }
        }

        // 通用插入方法
        function insertText(content) {
            const editor = document.getElementById('content');
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            editor.value = editor.value.slice(0, start) + content + editor.value.slice(end);
            editor.focus();
            editor.selectionStart = editor.selectionEnd = start + content.length;
            editor.dispatchEvent(new Event('input'));
        }

        // 增强预览功能
        marked.setOptions({
            breaks: true,
            highlight: function(code) {
                return hljs.highlightAuto(code).value;
            }
        });

        // 粘贴图片处理
        document.getElementById('content').addEventListener('paste', async (e) => {
            const items = e.clipboardData.items;
            for (let item of items) {
                if (item.type.indexOf('image') !== -1) {
                    const file = item.getAsFile();
                    // 调用图片上传逻辑
                    alert('检测到图片粘贴，请使用图片上传功能');
                }
            }
        });
    </script>

    <!-- 新增依赖库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
</body>
</html>
