<!DOCTYPE html>
<html>
<head>
    <title>å¢å¼ºç‰ˆåšå®¢åˆ›ä½œç³»ç»Ÿ</title>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* æ–°å¢æ ·å¼éƒ¨åˆ† */
        .toolbar { margin: 10px 0; display: flex; gap: 8px; flex-wrap: wrap; }
        .toolbar button { padding: 6px 12px; background: #6c757d; }
        .emojipicker { 
            position: absolute; 
            background: white; 
            border: 1px solid #ccc; 
            padding: 10px; 
            max-height: 200px; 
            overflow-y: auto;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .media-preview { max-width: 200px; margin: 5px; }
    </style>
</head>
<body>
    <!-- åœ¨åŸé…ç½®åŸºç¡€ä¸Šæ–°å¢å·¥å…·æ  -->
    <div class="toolbar">
        <button onclick="insertEmoji('ğŸ˜€')">ğŸ˜€ è¡¨æƒ…</button>
        <button onclick="showEmojiPanel()">ğŸ˜º è¡¨æƒ…åŒ…</button>
        <button onclick="insertImage()"><i class="fas fa-image"></i> å›¾ç‰‡</button>
        <button onclick="insertVideo()"><i class="fas fa-video"></i> è§†é¢‘</button>
        <button onclick="insertTemplate()"><i class="fas fa-file-alt"></i> æ¨¡æ¿</button>
    </div>

    <!-- åŸæœ‰ç¼–è¾‘åŒºä¿æŒä¸å˜ï¼Œæ–°å¢ä»¥ä¸‹éšè—å…ƒç´  -->
    <input type="file" id="imageUpload" hidden accept="image/*">
    <div id="emojiPanel" class="emojipicker" style="display: none;"></div>

    <script>
        // æ–°å¢åŠŸèƒ½å®ç°éƒ¨åˆ†
        const EMOJIS = ['ğŸ˜€','ğŸ˜‚','ğŸ˜','ğŸ¤”','ğŸ‘','ğŸ‘','ğŸ‰','â¤ï¸','ğŸ”¥','ğŸ’¡'];
        const TEMPLATES = {
            codeBlock: "```javascript\n// ä»£ç ç¤ºä¾‹\nfunction example() {\n  console.log('Hello World');\n}\n```",
            quote: "> ç»å…¸å¼•ç”¨å†…å®¹"
        };

        // æ˜¾ç¤ºè¡¨æƒ…é¢æ¿
        function showEmojiPanel() {
            const panel = document.getElementById('emojiPanel');
            panel.innerHTML = EMOJIS.map(e => 
                `<button onclick="insertEmoji('${e}')" style="font-size: 24px; margin: 3px;">${e}</button>`
            ).join('');
            panel.style.display = 'block';
            setTimeout(() => window.addEventListener('click', closeEmojiPanel), 0);
        }

        function closeEmojiPanel() {
            document.getElementById('emojiPanel').style.display = 'none';
            window.removeEventListener('click', closeEmojiPanel);
        }

        // æ’å…¥è¡¨æƒ…
        function insertEmoji(emoji) {
            insertText(` ${emoji} `);
        }

        // å›¾ç‰‡å¤„ç†
        function insertImage() {
            document.getElementById('imageUpload').click();
        }

        document.getElementById('imageUpload').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            try {
                // æ­¤å¤„æ›¿æ¢ä¸ºä½ çš„å›¾ç‰‡ä¸Šä¼ APIåœ°å€ï¼ˆéœ€è‡ªè¡Œå®ç°æˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹æœåŠ¡ï¼‰
                const formData = new FormData();
                formData.append('image', file);
                
                // ç¤ºä¾‹ä½¿ç”¨imguråŒ¿åä¸Šä¼ ï¼ˆéœ€éµå®ˆå…¶APIè§„åˆ™ï¼‰
                const response = await fetch('https://api.imgur.com/3/image', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Client-ID YOUR_CLIENT_ID'
                    },
                    body: formData
                });
                
                const data = await response.json();
                if (data.success) {
                    insertText(`![å›¾ç‰‡æè¿°](${data.data.link})`);
                }
            } catch (error) {
                alert('å›¾ç‰‡ä¸Šä¼ å¤±è´¥: ' + error.message);
            }
        });

        // æ’å…¥è§†é¢‘ï¼ˆæ”¯æŒä¸»æµå¹³å°ï¼‰
        function insertVideo() {
            const url = prompt('è¯·è¾“å…¥è§†é¢‘é“¾æ¥ï¼ˆYouTube/Bç«™ç­‰ï¼‰:');
            if (url) {
                if (url.includes('youtube') || url.includes('youtu.be')) {
                    const vid = url.match(/(?:v=|\/)([a-zA-Z0-9_-]{11})/)[1];
                    insertText(`\n<iframe width="560" height="315" src="https://www.youtube.com/embed/${vid}" frameborder="0" allowfullscreen></iframe>\n`);
                } else if (url.includes('bilibili')) {
                    const vid = url.match(/video\/(BV\w+)/)[1];
                    insertText(`\n<iframe src="//player.bilibili.com/player.html?bvid=${vid}" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>\n`);
                } else {
                    insertText(`\n[è§†é¢‘](${url})\n`);
                }
            }
        }

        // æ’å…¥å†™ä½œæ¨¡æ¿
        function insertTemplate() {
            const choice = prompt('é€‰æ‹©æ¨¡æ¿:\n1. ä»£ç å—\n2. å¼•ç”¨');
            switch(choice) {
                case '1': insertText(TEMPLATES.codeBlock); break;
                case '2': insertText(TEMPLATES.quote); break;
            }
        }

        // é€šç”¨æ’å…¥æ–¹æ³•
        function insertText(content) {
            const editor = document.getElementById('content');
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            editor.value = editor.value.slice(0, start) + content + editor.value.slice(end);
            editor.focus();
            editor.selectionStart = editor.selectionEnd = start + content.length;
            editor.dispatchEvent(new Event('input'));
        }

        // å¢å¼ºé¢„è§ˆåŠŸèƒ½
        marked.setOptions({
            breaks: true,
            highlight: function(code) {
                return hljs.highlightAuto(code).value;
            }
        });

        // ç²˜è´´å›¾ç‰‡å¤„ç†
        document.getElementById('content').addEventListener('paste', async (e) => {
            const items = e.clipboardData.items;
            for (let item of items) {
                if (item.type.indexOf('image') !== -1) {
                    const file = item.getAsFile();
                    // è°ƒç”¨å›¾ç‰‡ä¸Šä¼ é€»è¾‘
                    alert('æ£€æµ‹åˆ°å›¾ç‰‡ç²˜è´´ï¼Œè¯·ä½¿ç”¨å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½');
                }
            }
        });
    </script>

    <!-- æ–°å¢ä¾èµ–åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
</body>
</html>
